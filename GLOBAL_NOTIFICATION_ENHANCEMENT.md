# ุชุญุณููุงุช ุงูุฅุดุนุงุฑุงุช ุงูุนุงูููุฉ

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงูููุฌูุฏ ูุถูุงู ูุตูู ุงูุฅุดุนุงุฑุงุช ูููุดุฑููู ูุฃูููุงุก ุงูุฃููุฑ ูู ุฃู ููุงู ูู ุงูุนุงููุ ุจุบุถ ุงููุธุฑ ุนู ุงูููุทูุฉ ุงูุฒูููุฉ ุฃู ุงููููุน ุงูุฌุบุฑุงูู.

## ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### 1. ูุธุงู ุงูุทุงุจูุฑ ุงูุนุงููู (Global Queue System)

#### ุงููููุงุช ุงูุฌุฏูุฏุฉ:
- `lib/services/global_notification_monitor.dart` - ูุฑุงูุจ ุงูุฅุดุนุงุฑุงุช ุงูุนุงููู

#### ุงูููุฒุงุช:
- **ุทุงุจูุฑ FCM ุนุงููู**: ุญูุธ ุงูุฅุดุนุงุฑุงุช ูู `fcm_global_queue` ูููุนุงูุฌุฉ ุงููุงุญูุฉ
- **ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงูุชููุงุฆูุฉ**: ุญุชู 3 ูุญุงููุงุช ููู ุฅุดุนุงุฑ
- **ูุฑุงูุจุฉ ูุณุชูุฑุฉ**: ูุฑุงูุจุฉ ุงูุทุงุจูุฑ ูุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช ุชููุงุฆูุงู
- **ุชูุธูู ุชููุงุฆู**: ุญุฐู ุงูุฅุดุนุงุฑุงุช ุงููุฏููุฉ ุจุนุฏ 7 ุฃูุงู

### 2. ุชุญุณูู FCM Tokens

#### ูู `unified_notification_service.dart`:
```dart
// ุญูุธ Token ูุน ุฅุนุฏุงุฏุงุช ุนุงูููุฉ
await _firestore.collection('users').doc(user.uid).update({
  'fcmToken': token,
  'globalDeliveryEnabled': true,
  'lastSeen': FieldValue.serverTimestamp(),
  'deviceInfo': {
    'platform': Platform.operatingSystem,
    'version': Platform.operatingSystemVersion,
  }
});

// ุชุณุฌูู ูู ูุฌููุนุฉ ูููุตูุฉ ููุชุณููู ุงูุนุงููู
await _firestore.collection('global_fcm_tokens').doc(userId).set({
  'token': token,
  'userId': userId,
  'globalDelivery': true,
  'active': true,
});
```

### 3. ุฅุนุฏุงุฏุงุช FCM ูุญุณูุฉ ูููุตูู ุงูุนุงููู

#### Android:
```dart
'android': {
  'priority': 'high',
  'ttl': '2419200s', // 4 ุฃุณุงุจูุน ุจุฏูุงู ูู 24 ุณุงุนุฉ
  'notification': {
    'local_only': false, // ููู ูููุตูู ุงูุนุงููู
    'priority': 'high',
    'visibility': 'public',
  }
}
```

#### iOS:
```dart
'apns': {
  'headers': {
    'apns-priority': '10',
    'apns-expiration': '4 weeks', // ุงูุชูุงุก ุจุนุฏ 4 ุฃุณุงุจูุน
  },
  'payload': {
    'aps': {
      'content-available': 1,
      'mutable-content': 1,
    }
  }
}
```

### 4. ูุธุงู ุงููุฑุงูุจุฉ ูุงูุฅุญุตุงุฆูุงุช

#### ูุฑุงูุจุฉ ุงูุทุงุจูุฑ:
- ูุฑุงูุจุฉ ูุณุชูุฑุฉ ููุฅุดุนุงุฑุงุช ุงููุนููุฉ
- ูุนุงูุฌุฉ ุชููุงุฆูุฉ ููุฅุดุนุงุฑุงุช ุงูุฌุฏูุฏุฉ
- ุฅุนุงุฏุฉ ูุญุงููุฉ ููุฅุดุนุงุฑุงุช ุงููุงุดูุฉ

#### ุงูุฅุญุตุงุฆูุงุช:
```dart
final stats = await GlobalNotificationMonitor().getQueueStats();
// {pending: 5, completed: 120, failed: 2}
```

## ููููุฉ ุนูู ุงููุธุงู

### 1. ุฅุฑุณุงู ุงูุฅุดุนุงุฑ
```dart
// ุงูุฅุฑุณุงู ุงูุนุงุฏู + ุงูุทุงุจูุฑ ุงูุนุงููู
await enhancedService.sendNotificationToUser(
  userId: 'parent_123',
  title: 'ุฑูุจ ุฃุญูุฏ ุงูุจุงุต',
  body: 'ุฑูุจ ุฃุญูุฏ ุงูุจุงุต ูู ุงูุณุงุนุฉ 7:30 ุตุจุงุญุงู',
  type: 'student',
);
```

### 2. ุงููุนุงูุฌุฉ ุงูุนุงูููุฉ
1. **ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**: ุงูุฅุดุนุงุฑ ููุญูุธ ููุฑุงู
2. **ุฅุฑุณุงู ูุญูู**: ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุชุตู
3. **ุทุงุจูุฑ ุนุงููู**: ุฅุถุงูุฉ ููุทุงุจูุฑ ูููุนุงูุฌุฉ ุงููุงุญูุฉ
4. **ูุฑุงูุจุฉ ูุณุชูุฑุฉ**: ุงููุฑุงูุจ ูุนุงูุฌ ุงูุทุงุจูุฑ ุชููุงุฆูุงู
5. **ุฅุนุงุฏุฉ ุงููุญุงููุฉ**: ุญุชู 3 ูุญุงููุงุช ููุฅุดุนุงุฑุงุช ุงููุงุดูุฉ

### 3. ุงููุตูู ุงูุนุงููู
- **TTL ุทููู**: 4 ุฃุณุงุจูุน ุจุฏูุงู ูู 24 ุณุงุนุฉ
- **ุฃููููุฉ ุนุงููุฉ**: ุถูุงู ูุตูู ุงูุฅุดุนุงุฑุงุช
- **ุฅุนุงุฏุฉ ูุญุงููุฉ**: ููุชุนุงูู ูุน ูุดุงูู ุงูุดุจูุฉ
- **ูุฑุงูุจุฉ ูุณุชูุฑุฉ**: ููุชุฃูุฏ ูู ุงูุชุณููู

## ุงูููุงุฆุฏ ูููุณุชุฎุฏููู

### ูููุดุฑููู:
- โ **ุฅุดุนุงุฑุงุช ููุฑูุฉ** ุนูุฏ ุฑููุจ/ูุฒูู ุงูุทูุงุจ
- โ **ูุตูู ุนุงููู** ูู ุฃู ููุงู ูู ุงูุนุงูู
- โ **ููุซูููุฉ ุนุงููุฉ** ูุน ุฅุนุงุฏุฉ ุงููุญุงููุฉ
- โ **ุนูู ูู ุงูุฎูููุฉ** ุญุชู ูู ูุงู ุงูุชุทุจูู ูุบูู

### ูุฃูููุงุก ุงูุฃููุฑ:
- โ **ุฅุดุนุงุฑุงุช ููุฑูุฉ** ุนู ุฃุทูุงููู
- โ **ูุตูู ุนุงููู** ุฃุซูุงุก ุงูุณูุฑ
- โ **ููุซูููุฉ ุนุงููุฉ** ูุง ุชููุช ุฃู ุฅุดุนุงุฑ
- โ **ุชุญุฏูุซุงุช ูุณุชูุฑุฉ** ุนู ุญุงูุฉ ุงูุทูู

## ุงูุชูุงูู ูุน ุงููุธุงู ุงูููุฌูุฏ

### ูุง ูุคุซุฑ ุนูู ุงูููุฏ ุงูููุฌูุฏ:
- โ ุฌููุน ุงูุฏูุงู ุงูููุฌูุฏุฉ ุชุนูู ููุง ูู
- โ ุฅุถุงูุฉ ุทุจูุฉ ุฅุถุงููุฉ ููููุซูููุฉ
- โ ุชุญุณูู ุงูุฃุฏุงุก ูุงููุตูู
- โ ูุง ุญุงุฌุฉ ูุชุบููุฑ ุงูููุฏ ุงูููุฌูุฏ

### ุงูุชููุฆุฉ ุงูุชููุงุฆูุฉ:
```dart
// ูุชู ุชุดุบูู ุงููุธุงู ุงูุนุงููู ุชููุงุฆูุงู
await EnhancedNotificationService().initialize();
// โ ุงููุธุงู ุงูุนุงููู ูุนูู ูู ุงูุฎูููุฉ
```

## ูุฑุงูุจุฉ ุงููุธุงู

### ุฅุญุตุงุฆูุงุช ุงูุทุงุจูุฑ:
```dart
final monitor = GlobalNotificationMonitor();
final stats = await monitor.getQueueStats();
print('ูุนูู: ${stats['pending']}');
print('ููุชูู: ${stats['completed']}');
print('ูุงุดู: ${stats['failed']}');
```

### ุชูุธูู ุงูุทุงุจูุฑ:
```dart
// ุชูุธูู ุชููุงุฆู ููุฅุดุนุงุฑุงุช ุงููุฏููุฉ
await monitor.cleanupOldQueueItems();
```

## ุงูุฎุทูุงุช ุงูุชุงููุฉ ููุฅูุชุงุฌ

### 1. ุฅุนุฏุงุฏ Firebase Admin SDK:
- ุงูุญุตูู ุนูู Server Key ูู Firebase Console
- ุฅุนุฏุงุฏ Cloud Functions ูููุนุงูุฌุฉ ุงูุฎูููุฉ
- ุชูุนูู Firebase Admin SDK

### 2. ุฅุนุฏุงุฏ ุงูุฎุงุฏู ุงูุฎููู:
- ุฎุงุฏู ููุนุงูุฌุฉ ุงูุทุงุจูุฑ ุงูุนุงููู
- ูุฑุงูุจุฉ ูุณุชูุฑุฉ 24/7
- ุฅุญุตุงุฆูุงุช ูุชูุงุฑูุฑ

### 3. ูุฑุงูุจุฉ ุงูุฃุฏุงุก:
- ุชุชุจุน ูุนุฏู ูุฌุงุญ ุงูุชุณููู
- ูุฑุงูุจุฉ ุฃููุงุช ุงูุงุณุชุฌุงุจุฉ
- ุชุญููู ุฃุณุจุงุจ ุงููุดู

## ุงูุฎูุงุตุฉ

ุงููุธุงู ุงูุขู ูุถูู:
- ๐ **ูุตูู ุนุงููู** ููุฅุดุนุงุฑุงุช ูู ุฃู ููุงู
- ๐ **ููุซูููุฉ ุนุงููุฉ** ูุน ุฅุนุงุฏุฉ ุงููุญุงููุฉ
- โก **ุฃุฏุงุก ูุญุณู** ูุน ุงูุทุงุจูุฑ ุงูุนุงููู
- ๐ **ูุฑุงูุจุฉ ุดุงููุฉ** ูููุธุงู
- ๐ก๏ธ **ุงุณุชูุฑุงุฑ ุนุงูู** ูุน ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก

ุงููุดุฑููู ูุฃูููุงุก ุงูุฃููุฑ ุณูุญุตููู ุนูู ุฅุดุนุงุฑุงุชูู ุจููุซูููุฉ ุนุงููุฉ ูู ุฃู ููุงู ูู ุงูุนุงูู!
