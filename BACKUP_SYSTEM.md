# نظام النسخ الاحتياطي - MyBus App

## 🎯 نظرة عامة

تم تطوير نظام نسخ احتياطي شامل ومتقدم لتطبيق MyBus يضمن حماية البيانات واستمرارية الخدمة.

## ✨ الميزات الرئيسية

### 🔄 النسخ الاحتياطي التلقائي
- **تشغيل تلقائي**: يعمل كل 24 ساعة افتراضياً
- **قابل للتخصيص**: يمكن تغيير الفترة الزمنية
- **ذكي**: يتحقق من آخر نسخة قبل إنشاء نسخة جديدة

### 📦 النسخ اليدوي
- **إنشاء فوري**: إنشاء نسخة احتياطية بضغطة واحدة
- **تقارير مفصلة**: عرض تفاصيل النسخة المنشأة
- **مؤشرات التقدم**: عرض حالة العملية في الوقت الفعلي

### 🔍 إدارة النسخ
- **قائمة النسخ**: عرض جميع النسخ المتاحة
- **معلومات مفصلة**: تاريخ الإنشاء، الحجم، عدد السجلات
- **تنظيف تلقائي**: الاحتفاظ بآخر 10 نسخ فقط

### 🔄 الاستعادة الآمنة
- **تأكيد متعدد**: تحذيرات واضحة قبل الاستعادة
- **معاينة البيانات**: عرض محتوى النسخة قبل الاستعادة
- **استعادة شاملة**: استعادة جميع المجموعات والبيانات

## 📊 البيانات المشمولة

يتم نسخ المجموعات التالية:
- ✅ **الطلاب** (students)
- ✅ **المستخدمين** (users)
- ✅ **الحافلات** (buses)
- ✅ **تعيينات المشرفين** (supervisor_assignments)
- ✅ **الغيابات** (absences)
- ✅ **الشكاوى** (complaints)
- ✅ **الاستبيانات** (surveys)
- ✅ **ردود الاستبيانات** (survey_responses)
- ✅ **الإشعارات** (notifications)
- ✅ **الرحلات** (trips)
- ✅ **تقييمات السلوك** (behavior_evaluations)
- ✅ **الإعدادات** (settings)

## 🛠️ كيفية الاستخدام

### من واجهة الأدمن:

1. **الوصول للنسخ الاحتياطي**:
   - اذهب إلى الصفحة الرئيسية للأدمن
   - اضغط على أيقونة "النسخ الاحتياطي"

2. **إنشاء نسخة يدوية**:
   - اضغط على "إنشاء نسخة"
   - انتظر اكتمال العملية
   - ستظهر رسالة تأكيد مع التفاصيل

3. **تفعيل النسخ التلقائي**:
   - في نافذة النسخ الاحتياطي
   - فعل مفتاح "النسخ التلقائي"
   - سيتم إنشاء نسخ كل 24 ساعة

4. **استعادة نسخة**:
   - اضغط على "استعادة"
   - اختر النسخة المطلوبة
   - اقرأ التحذيرات بعناية
   - أكد العملية

5. **عرض الإحصائيات**:
   - اضغط على "الإحصائيات"
   - شاهد معلومات مفصلة عن النسخ

## ⚙️ الإعدادات المتقدمة

### تخصيص فترة النسخ:
```dart
await backupService.setBackupInterval(12); // كل 12 ساعة
```

### تفعيل/إلغاء النسخ التلقائي:
```dart
await backupService.setAutoBackupEnabled(true);
```

### الحصول على الإحصائيات:
```dart
final stats = await backupService.getBackupStatistics();
```

## 🔒 الأمان والحماية

- **تشفير البيانات**: جميع النسخ محفوظة بشكل آمن في Firestore
- **صلاحيات محدودة**: فقط الأدمن يمكنه الوصول للنسخ
- **تأكيد متعدد**: تحذيرات واضحة قبل عمليات الاستعادة
- **سجل العمليات**: تسجيل جميع عمليات النسخ والاستعادة

## 📈 المراقبة والتتبع

- **سجلات مفصلة**: تسجيل جميع العمليات في وحدة التحكم
- **إشعارات الحالة**: رسائل واضحة عن نجاح أو فشل العمليات
- **إحصائيات شاملة**: معلومات عن عدد النسخ والأحجام والتواريخ

## 🚨 التحذيرات المهمة

⚠️ **تحذير**: استعادة النسخة الاحتياطية ستحذف جميع البيانات الحالية!

⚠️ **تنبيه**: تأكد من إنشاء نسخة احتياطية حديثة قبل أي تحديثات مهمة

⚠️ **ملاحظة**: يتم الاحتفاظ بآخر 10 نسخ فقط لتوفير مساحة التخزين

## 🔧 استكشاف الأخطاء

### مشاكل شائعة وحلولها:

1. **فشل في إنشاء النسخة**:
   - تحقق من اتصال الإنترنت
   - تأكد من صلاحيات Firestore
   - راجع سجلات الأخطاء

2. **النسخ التلقائي لا يعمل**:
   - تأكد من تفعيل الخدمة
   - تحقق من إعدادات التطبيق
   - أعد تشغيل التطبيق

3. **فشل في الاستعادة**:
   - تحقق من صحة النسخة المختارة
   - تأكد من وجود مساحة كافية
   - راجع صلاحيات قاعدة البيانات

## 📞 الدعم الفني

في حالة مواجهة أي مشاكل:
1. راجع سجلات الأخطاء في وحدة التحكم
2. تحقق من حالة الاتصال بـ Firebase
3. تواصل مع فريق التطوير مع تفاصيل الخطأ

---

**تم التطوير بواسطة**: فريق تطوير MyBus  
**آخر تحديث**: 2025-08-02  
**الإصدار**: 1.0.0
