# ุฏููู ุฅุนุฏุงุฏ Firebase Cloud Messaging (FCM) ููุฅุดุนุงุฑุงุช ุงูุฎุงุฑุฌูุฉ

## ๐ฑ ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงููุญุฏุซ

ุชู ุชุทููุฑ ูุธุงู ุฅุดุนุงุฑุงุช ูุชูุฏู ูุฏุนู ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช ุฎุงุฑุฌ ุงูุชุทุจูู (Push Notifications) ูุฌููุน ุฃููุงุน ุงููุณุชุฎุฏููู:
- ๐จโ๐ป **ุงูุฃุฏูู** - ุฅุดุนุงุฑุงุช ุงูุดูุงูู ูุงูุฑุณุงุฆู ุงูุฅุฏุงุฑูุฉ
- ๐จโ๐ผ **ุงููุดุฑู** - ุฅุดุนุงุฑุงุช ุงูุฑุญูุงุช ูุญุงูุฉ ุงูุทูุงุจ
- ๐จโ๐ฉโ๐งโ๐ฆ **ููู ุงูุฃูุฑ** - ุฅุดุนุงุฑุงุช ุญุงูุฉ ุงูุทุงูุจ ูุงูุฑุณุงุฆู

## ๐ง ุงููููุงุช ุงููุถุงูุฉ/ุงููุญุฏุซุฉ

### ุงูุฎุฏูุงุช ุงูุฌุฏูุฏุฉ:
- `lib/services/notification_sender_service.dart` - ุฎุฏูุฉ ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช ุงููุณุชูุฏูุฉ
- `lib/screens/admin/send_notification_screen.dart` - ุตูุญุฉ ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช ุงูุฅุฏุงุฑูุฉ

### ุงูุฎุฏูุงุช ุงููุญุฏุซุฉ:
- `lib/services/fcm_service.dart` - ุชุญุณูู ุญูุธ ุงูู tokens ูุฅุถุงูุฉ ุฏูุงู ุงูุฅุฑุณุงู
- `lib/screens/parent/add_complaint_screen.dart` - ุฅุถุงูุฉ ุฅุฑุณุงู ุฅุดุนุงุฑ ููุฃุฏูู ุนูุฏ ุงูุดููู
- `lib/screens/supervisor/absence_management_screen.dart` - ุฅุถุงูุฉ ุฅุฑุณุงู ุฅุดุนุงุฑ ูููู ุงูุฃูุฑ ุนูุฏ ุงูุบูุงุจ
- `lib/screens/admin/student_management_screen.dart` - ุฅุถุงูุฉ ุฏูุงู ุชุญุฏูุซ ุญุงูุฉ ุงูุทุงูุจ ูุน ุงูุฅุดุนุงุฑุงุช

## ๐ ููููุฉ ุงูุนูู ุญุงููุงู

### 1. ุญูุธ ุงูู Tokens:
- ูุชู ุญูุธ FCM Token ููู ูุณุชุฎุฏู ูุน ููุนู ูู ูุฌููุนุชูู:
  - `users/{userId}` - ุจูุงูุงุช ุงููุณุชุฎุฏู ูุน ุงูู token
  - `fcm_tokens/{userId}` - tokens ูููุตูุฉ ููุจุญุซ ุงูุณุฑูุน

### 2. ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช:
- **ููููุน ุงููุญุฏุฏ**: `sendNotificationToUserType(userType: 'admin')`
- **ููุณุชุฎุฏู ูุญุฏุฏ**: `sendNotificationToUser(userId: 'user123')`
- **ุทูุงุฑุฆ ูุฌููุน ุงููุณุชุฎุฏููู**: `sendEmergencyNotification()`

### 3. ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู:

```dart
// ุฅุฑุณุงู ุดููู ุฌุฏูุฏุฉ ููุฃุฏูู
await _notificationSender.sendComplaintNotificationToAdmin(
  complaintId: 'complaint123',
  studentName: 'ุฃุญูุฏ ูุญูุฏ',
  complaintType: 'ุดููู ูู ุงูุณุงุฆู',
);

// ุฅุฑุณุงู ุชุญุฏูุซ ุญุงูุฉ ุงูุทุงูุจ ูููู ุงูุฃูุฑ
await _notificationSender.sendStudentStatusNotificationToParent(
  parentId: 'parent123',
  studentName: 'ุฃุญูุฏ ูุญูุฏ',
  status: 'boarded',
  busNumber: '123',
  location: 'ุงููุฏุฑุณุฉ',
);

// ุฅุฑุณุงู ุฑุณุงูุฉ ุฅุฏุงุฑูุฉ
await _notificationSender.sendAdminMessage(
  title: 'ุฅุนูุงู ููู',
  message: 'ุณูุชู ุชุบููุฑ ููุงุนูุฏ ุงูุญุงููุงุช ุบุฏุงู',
  targetUserType: 'parent', // ุฃู null ูุฌููุน ุงููุณุชุฎุฏููู
);
```

## โ๏ธ ููุญุตูู ุนูู ุฅุดุนุงุฑุงุช ุญููููุฉ ุฎุงุฑุฌ ุงูุชุทุจูู

ุญุงููุงู ุงููุธุงู ูุญูุธ ุงูุฅุดุนุงุฑุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุท. ููุญุตูู ุนูู ุฅุดุนุงุฑุงุช push ุญููููุฉุ ุชุญุชุงุฌ ุฅูู:

### 1. ุงูุญุตูู ุนูู Server Key ูู Firebase:
1. ุงุฐูุจ ุฅูู [Firebase Console](https://console.firebase.google.com)
2. ุงุฎุชุฑ ูุดุฑูุนู
3. ุงุฐูุจ ุฅูู Project Settings > Cloud Messaging
4. ุงูุณุฎ ุงูู Server Key

### 2. ุชุญุฏูุซ ุฏุงูุฉ `_sendPushNotification` ูู `fcm_service.dart`:

```dart
Future<void> _sendPushNotification({
  required String token,
  required String title,
  required String body,
  required Map<String, String> data,
  required String channelId,
}) async {
  try {
    final response = await http.post(
      Uri.parse('https://fcm.googleapis.com/fcm/send'),
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'key=YOUR_SERVER_KEY_HERE', // ุถุน Server Key ููุง
      },
      body: jsonEncode({
        'to': token,
        'notification': {
          'title': title,
          'body': body,
          'sound': 'default',
        },
        'data': data,
        'android': {
          'notification': {
            'channel_id': channelId,
            'sound': 'default',
            'priority': 'high',
          },
        },
        'apns': {
          'payload': {
            'aps': {
              'sound': 'default',
              'badge': 1,
            },
          },
        },
      }),
    );

    if (response.statusCode == 200) {
      debugPrint('โ Push notification sent successfully');
    } else {
      debugPrint('โ Failed to send push notification: ${response.statusCode}');
    }
  } catch (e) {
    debugPrint('โ Error sending push notification: $e');
  }
}
```

### 3. ุฅุถุงูุฉ import ููู http:
```dart
import 'package:http/http.dart' as http;
```

## ๐ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช ุงููุฏุนููุฉ

### ููุฃุฏูู:
- ๐ ุดูุงูู ุฌุฏูุฏุฉ ูู ุฃูููุงุก ุงูุฃููุฑ
- ๐จ ุชูุจููุงุช ุงููุธุงู ูุงูุทูุงุฑุฆ
- ๐ ุชูุงุฑูุฑ ูุฅุญุตุงุฆูุงุช

### ูููุดุฑู:
- ๐ ุจุฏุงูุฉ ูุงูุชูุงุก ุงูุฑุญูุงุช
- ๐จโ๐ ุชุญุฏูุซุงุช ุญุงูุฉ ุงูุทูุงุจ
- โ๏ธ ุชูุจููุงุช ุงูุทูุงุฑุฆ

### ูููู ุงูุฃูุฑ:
- ๐ ุฑููุจ/ูุฒูู ุงูุทุงูุจ ูู ุงูุญุงููุฉ
- โ ุชุณุฌูู ุบูุงุจ ุงูุทุงูุจ
- โฐ ุชุฃุฎูุฑ ุงูุญุงููุฉ
- ๐ ุฑุณุงุฆู ุฅุฏุงุฑูุฉ
- โญ ุชููููุงุช ุณููู ุงูุทุงูุจ

## ๐ฑ ูููุงุช ุงูุฅุดุนุงุฑุงุช

- `mybus_notifications` - ุงูุฅุดุนุงุฑุงุช ุงูุนุงูุฉ
- `student_notifications` - ุฅุดุนุงุฑุงุช ุงูุทูุงุจ
- `bus_notifications` - ุฅุดุนุงุฑุงุช ุงูุญุงููุงุช
- `emergency_notifications` - ุฅุดุนุงุฑุงุช ุงูุทูุงุฑุฆ

## ๐ฏ ุงูููุฒุงุช ุงููุชูุฏูุฉ

### 1. ุชุตููุฉ ุงูุฅุดุนุงุฑุงุช:
- ุฅุฑุณุงู ูููุณุชุฎุฏู ุงูุตุญูุญ ููุท
- ุชุฌูุจ ุงูุฅุดุนุงุฑุงุช ุงูููุฑุฑุฉ
- ุฏุนู ุงูุฅุดุนุงุฑุงุช ุงููุณุชูุฏูุฉ

### 2. ุฅุฏุงุฑุฉ ุงูู Tokens:
- ุชุญุฏูุซ ุชููุงุฆู ููู tokens
- ุญุฐู ุงูู tokens ุบูุฑ ุงููุดุทุฉ
- ุฏุนู ููุตุงุช ูุชุนุฏุฏุฉ (Android/iOS)

### 3. ุฃููููุงุช ุงูุฅุดุนุงุฑุงุช:
- ุนุงุฏูุฉ ููุฑุณุงุฆู ุงูุฅุฏุงุฑูุฉ
- ุนุงููุฉ ูุชุญุฏูุซุงุช ุงูุทูุงุจ
- ุทูุงุฑุฆ ููุญุงูุงุช ุงูุญุฑุฌุฉ

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ูู ุชุตู ุงูุฅุดุนุงุฑุงุช:
1. ุชุฃูุฏ ูู ุฃู ุงูู Server Key ุตุญูุญ
2. ุชุญูู ูู ุฃู ุงูู Token ูุญููุธ ุจุดูู ุตุญูุญ
3. ุชุฃูุฏ ูู ุฃู ุงููุณุชุฎุฏู ูุฏูู ุตูุงุญูุงุช ุงูุฅุดุนุงุฑุงุช
4. ุฑุงุฌุน logs ุงูุชุทุจูู ููุฃุฎุทุงุก

### ููุงุฎุชุจุงุฑ:
1. ุงุณุชุฎุฏู ุตูุญุฉ "ุฅุฑุณุงู ุฅุดุนุงุฑ ุฅุฏุงุฑู" ูู ููุญุฉ ุงูุฃุฏูู
2. ุฌุฑุจ ุฅุฑุณุงู ุดููู ูู ุญุณุงุจ ููู ุฃูุฑ
3. ุณุฌู ุบูุงุจ ุทุงูุจ ูู ุญุณุงุจ ุงููุดุฑู

## ๐ ุงูุฏุนู

ุงููุธุงู ุฌุงูุฒ ููุนูู ููุฏุนู ุฌููุน ุฃููุงุน ุงูุฅุดุนุงุฑุงุช. ููุท ุฃุถู ุงูู Server Key ููุญุตูู ุนูู ุฅุดุนุงุฑุงุช push ุญููููุฉ ุฎุงุฑุฌ ุงูุชุทุจูู.
